<!DOCTYPE html>
<!--Converted via md-to-html-->
<html>
 <head>
 </head>
 <body>
  <h1>
   Gateway Configuration
  </h1>
  <p>
   Here you can find a complete Ruuvi Gateway configuration guide for advanced users.
  </p>
  <h2>
   Current firmware version information
  </h2>
  <p>
   Firmware version information can be found at the bottom of each page:
  </p>
  <p>
   <img alt="start_page" src="images/start_page.png"/>
  </p>
  <p>
   There are two version numbers:
  </p>
  <ul>
   <li>
    Ruuvi Gateway firmware version (v1.13.0).
    <a href="https://github.com/ruuvi/ruuvi.gateway_esp.c">
     GitHub repo
    </a>
   </li>
  </ul>
  <ul>
   <li>
    Ruuvi Gateway nRF52 co-processor firmware version (v1.0.0)
    <a href="https://github.com/ruuvi/ruuvi.gateway_nrf.c">
     GitHub repo
    </a>
   </li>
  </ul>
  <h2>
   Connect Ruuvi Gateway to the Internet
  </h2>
  <h3>
   Ethernet – Advanced options
  </h3>
  <p>
   If you want to configure your Ruuvi Gateway to use a static IP address
  </p>
  <p>
   please uncheck
   <strong>
    Use DHCP
   </strong>
   after selecting the Ethernet connection option.
  </p>
  <p>
   The following fields are required for this configuration:
  </p>
  <ul>
   <li>
    <strong>
     Static IP
    </strong>
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     Netmask
    </strong>
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     Gateway
    </strong>
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     DNS IP 1
    </strong>
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     DNS IP 2
    </strong>
    (optional)
   </li>
  </ul>
  <p>
   <img alt="ethernet_advanced_options" src="images/ethernet_advanced_options.png"/>
  </p>
  <h3>
   Wi-Fi – Advanced Options
  </h3>
  <p>
   A hidden Wi-Fi network can be used for connecting your Ruuvi Gateway to internet.
  </p>
  <p>
   This setting is shown in the Wi-Fi Network configuration page under Advanced.
  </p>
  <p>
   Select
   <strong>
    Connect Manually
   </strong>
   to see the following required fields:
  </p>
  <ul>
   <li>
    <strong>
     SSID
    </strong>
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     Password
    </strong>
   </li>
  </ul>
  <p>
   <img alt="wifi_advanced_options" src="images/wifi_advanced_options.png"/>
  </p>
  <h2>
   Firmware update
  </h2>
  <p>
   It is always recommended to keep your Ruuvi Gateway up-to-date.
  </p>
  <p>
   Your firmware version and update availability will be checked on the
   <strong>
    Software Update
   </strong>
   page
  </p>
  <p>
   during the configuration process.
  </p>
  <p>
   If an update is available, you will be offered to install it from the default location
  </p>
  <p>
   (recommended).
  </p>
  <p>
   Alternatively, you can choose your own location for updates by checking **Specify a URL that
  </p>
  <p>
   contains required firmware update binaries
   <strong>
    under
   </strong>
   Advanced**.
  </p>
  <p>
   <img alt="software_update_advanced_options" src="images/software_update_advanced_options.png"/>
  </p>
  <p>
   If you want to use a previous release version, you can provide a link
  </p>
  <p>
   to GitHub
   <code>
    https://github.com/ruuvi/ruuvi.gateway_esp.c/releases/download/&lt;VERSION_TAG&gt;
   </code>
  </p>
  <p>
   where you need to replace
   <strong>
    &lt;VERSION_TAG&gt;
   </strong>
   with the version number you need.
  </p>
  <p>
   For example:
   <code>
    https://github.com/ruuvi/ruuvi.gateway_esp.c/releases/download/v1.13.0
   </code>
  </p>
  <p>
   Here you will find a list of the releases available for download:
  </p>
  <p>
   <a href="https://github.com/ruuvi/ruuvi.gateway_esp.c/releases">
    https://github.com/ruuvi/ruuvi.gateway_esp.c/releases
   </a>
  </p>
  <p>
   If you want to use a developer build, you can provide a link to the Jenkins build server
  </p>
  <p>
   <code>
    https://jenkins.ruuvi.com/job/ruuvi_gateway_esp-PR/&lt;BUILD&gt;/artifact/build/
   </code>
  </p>
  <p>
   where you need to replace
   <strong>
    &lt;BUILD&gt;
   </strong>
   with the build number you need.
  </p>
  <p>
   For example:
   <code>
    https://jenkins.ruuvi.com/job/ruuvi_gateway_esp-PR/805/artifact/build/
   </code>
  </p>
  <p>
   To start the firmware update process press the
   <em>
    Update
   </em>
   button.
  </p>
  <p>
   The firmware update process takes a few minutes,and you will see the progress on the screen.
  </p>
  <p>
   It's important to make sure that your Ruuvi Gateway remains powered during this time.
  </p>
  <p>
   <img alt="software_update_progress" src="images/software_update_progress.png"/>
  </p>
  <p>
   You can also skip this step by pressing
   <em>
    Continue without updating
   </em>
   .
  </p>
  <p>
   <img alt="software_update" src="images/software_update.png"/>
  </p>
  <h2>
   Automatic updates
  </h2>
  <p>
   Your Ruuvi Gateway has the ability to automatically check for and install new firmware updates
  </p>
  <p>
   using a scheduler. We recommend that you select
   <strong>
    Auto Update
   </strong>
   , which accepts new versions for
  </p>
  <p>
   installation 2 weeks after the release date.
  </p>
  <p>
   Advanced users can also select a special
   <strong>
    Auto Update for beta-testers
   </strong>
   mode that accepts new
  </p>
  <p>
   firmware versions and automatically installs them as they become available.
  </p>
  <p>
   Selecting
   <strong>
    Manual updates only
   </strong>
   disables automatic firmware updates for your gateway.
  </p>
  <p>
   <img alt="automatic_updates_select_mode" src="images/automatic_updates_select_mode.png"/>
  </p>
  <p>
   The automatic update scheduler allows you to specify when you want automatic updates to be
  </p>
  <p>
   fetched and installed. You can schedule updates to be checked by:
  </p>
  <ul>
   <li>
    <strong>
     Weekdays
    </strong>
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     Timeslot
    </strong>
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     Time zone
    </strong>
   </li>
  </ul>
  <p>
   <img alt="automatic_updates_advanced_options" src="images/automatic_updates_advanced_options.png"/>
  </p>
  <h2>
   Automatic Configuration Download
  </h2>
  <p>
   You can configure the gateway to download its configuration from a remote server (checking for
  </p>
  <p>
   an updated configuration will be performed with a set period).
  </p>
  <p>
   You just need to specify the base URL from where the configuration file with the Gateway settings
  </p>
  <p>
   can be downloaded.
  </p>
  <p>
   If you specify a folder name as the base URL (any URL that does not end with '.json'), it will first
  </p>
  <p>
   attempt to read the configuration file for the Gateway from &lt;GW_MAC&gt;.json (e.g. AABBCCDDEEFF.json).
  </p>
  <p>
   If this file fails, it will attempt to read the overall configuration from gw_cfg.json.
  </p>
  <p>
   The configuration file can also be generated dynamically by the server, which requires the server to
  </p>
  <p>
   analyse the HTTP header 'ruuvi_gw_mac', which contains the MAC address in the format XX:XX:XX:XX:XX:
  </p>
  <p>
   XX.
  </p>
  <p>
   After entering the base URL, press the Check button to validate the URL and check that the
  </p>
  <p>
   configuration file exists. Next, after pressing the Download button, the new configuration will be
  </p>
  <p>
   downloaded, which completes the configuration process. After that, Ruuvi Gateway will periodically
  </p>
  <p>
   check for configuration updates and download them. The polling period is set in the configuration
  </p>
  <p>
   file, which is downloaded from the server.
  </p>
  <p>
   <img alt="automatic_configuration_download_advanced_options" src="images/automatic_configuration_download_advanced_options.png"/>
  </p>
  <p>
   The gateway configuration file on the remote server must contain at least the following attributes:
  </p>
  <ul>
   <li>
    <strong>
     remote_cfg_use
    </strong>
    : true
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     remote_cfg_url
    </strong>
    : URL
   </li>
  </ul>
  <ul>
   <li>
    <strong>
     remote_cfg_refresh_interval_minutes
    </strong>
    : a period of checking for an updated configuration (in
   </li>
  </ul>
  <p>
   minutes)
  </p>
  <ul>
   <li>
    <strong>
     remote_cfg_auth_type
    </strong>
    : authentication type ('
    <strong>
     no
    </strong>
    ' if authentication is not required)
   </li>
  </ul>
  <p>
   Example of minimal gw_cfg.json:
  </p>
  <p>
   ```json
  </p>
  <p>
   {
  </p>
  <p>
   "remote_cfg_use": true,
  </p>
  <p>
   "remote_cfg_url": "
   <a href="http://192.168.1.101:7000/">
    http://192.168.1.101:7000/
   </a>
   ",
  </p>
  <p>
   "remote_cfg_refresh_interval_minutes": 10,
  </p>
  <p>
   "remote_cfg_auth_type": "no"
  </p>
  <p>
   }
  </p>
  <p>
   ```
  </p>
  <p>
   All configuration attributes not specified in the configuration file will retain their previous
  </p>
  <p>
   value after the new configuration is loaded from the remote server.
  </p>
  <p>
   Configuration downloads with basic HTTP authentication are also supported:
  </p>
  <p>
   <img alt="automatic_configuration_download_auth_basic" src="images/automatic_configuration_download_auth_basic.png"/>
  </p>
  <p>
   Example of corresponding minimal gw_cfg.json:
  </p>
  <p>
   ```json
  </p>
  <p>
   {
  </p>
  <p>
   "remote_cfg_use": true,
  </p>
  <p>
   "remote_cfg_url": "
   <a href="http://192.168.1.101:7000/">
    http://192.168.1.101:7000/
   </a>
   ",
  </p>
  <p>
   "remote_cfg_refresh_interval_minutes": 10,
  </p>
  <p>
   "remote_cfg_auth_type": "basic",
  </p>
  <p>
   "remote_cfg_auth_basic_user": "user1",
  </p>
  <p>
   "remote_cfg_auth_basic_pass": "password1"
  </p>
  <p>
   }
  </p>
  <p>
   ```
  </p>
  <p>
   Or bearer authentication (using a token):
  </p>
  <p>
   <img alt="automatic_configuration_download_auth_bearer" src="images/automatic_configuration_download_auth_bearer.png"/>
  </p>
  <p>
   Example of corresponding minimal gw_cfg.json:
  </p>
  <p>
   ```json
  </p>
  <p>
   {
  </p>
  <p>
   "remote_cfg_use": true,
  </p>
  <p>
   "remote_cfg_url": "
   <a href="http://192.168.1.101:7000/">
    http://192.168.1.101:7000/
   </a>
   ",
  </p>
  <p>
   "remote_cfg_refresh_interval_minutes": 10,
  </p>
  <p>
   "remote_cfg_auth_type": "bearer",
  </p>
  <p>
   "remote_cfg_auth_bearer_token": "my_secret_token_123"
  </p>
  <p>
   }
  </p>
  <p>
   ```
  </p>
  <h2>
   LAN Access Settings
  </h2>
  <p>
   You can restrict or allow access to your Ruuvi Gateway from the local network.
  </p>
  <p>
   By default, the access is
   <strong>
    Password protected
   </strong>
   using the default password (unique device ID which
  </p>
  <p>
   is printed on the bottom of the Ruuvi Gateway):
  </p>
  <p>
   <img alt="access_settings_default" src="images/access_settings_default.png"/>
  </p>
  <p>
   If you want to configure a custom
   <strong>
    Username
   </strong>
   and
   <strong>
    password
   </strong>
   , select **Protected with a
  </p>
  <p>
   custom password**:
  </p>
  <p>
   <img alt="access_settings_custom_password" src="images/access_settings_custom_password.png"/>
  </p>
  <p>
   You can also prohibit access by password by selecting
   <strong>
    No remote configurable
   </strong>
   or allow access
  </p>
  <p>
   without a password by selecting
   <strong>
    Remote configurable without a password
   </strong>
   .
  </p>
  <p>
   It is also possible to configure access to the Ruuvi Gateway from LAN using bearer
  </p>
  <p>
   authentication (under
   <strong>
    Advanced settings
   </strong>
   ):
  </p>
  <p>
   <img alt="access_settings_advanced_options" src="images/access_settings_advanced_options.png"/>
  </p>
  <p>
   If you set a token for read-only access, you can read data from the "/history" and
  </p>
  <p>
   "/metrics" endpoints, or read the gateway configuration. To be able to configure the gateway
  </p>
  <p>
   programmatically, a full (read/write) access token must be enabled.
  </p>
  <p>
   Examples:
  </p>
  <ul>
   <li>
    Request "/history" using read-only bearer token:
   </li>
  </ul>
  <pre><code>```shell
</code></pre>
  <pre><code>curl -v http://&lt;RUUVI_GW_IP&gt;/history 
</code></pre>
  <pre><code>  -H "Authorization: Bearer Uj+4tj24unVekco/lTLTRyxUfv1J8M6U+sbNsKTWRr0="
</code></pre>
  <pre><code>```
</code></pre>
  <ul>
   <li>
    Request "/metrics" using read-only bearer token:
   </li>
  </ul>
  <pre><code>```shell
</code></pre>
  <pre><code>curl -v http://&lt;RUUVI_GW_IP&gt;/metrics 
</code></pre>
  <pre><code>  -H "Authorization: Bearer Uj+4tj24unVekco/lTLTRyxUfv1J8M6U+sbNsKTWRr0="
</code></pre>
  <pre><code>```
</code></pre>
  <ul>
   <li>
    Download the gateway configuration using the read-only access bearer token and save it to file
   </li>
  </ul>
  <p>
   'ruuvi.json':
  </p>
  <pre><code>```shell
</code></pre>
  <pre><code>curl -v http://&lt;RUUVI_GW_IP&gt;/ruuvi.json 
</code></pre>
  <pre><code>  -H "Authorization: Bearer Uj+4tj24unVekco/lTLTRyxUfv1J8M6U+sbNsKTWRr0=" 
</code></pre>
  <pre><code>  --output ruuvi.json
</code></pre>
  <pre><code>```
</code></pre>
  <ul>
   <li>
    Upload the gateway configuration using the read-write access bearer token
   </li>
  </ul>
  <p>
   from the file './ruuvi.json' (note that the network part of the configuration will be ignored):
  </p>
  <pre><code>```shell
</code></pre>
  <pre><code>curl -v http://&lt;RUUVI_GW_IP&gt;/ruuvi.json 
</code></pre>
  <pre><code>  -H "Authorization: Bearer 1SDrQH1FkH+pON0GsSjt2gYeMSP02uYqfuu7LWdaBvY=" 
</code></pre>
  <pre><code>  -d @./ruuvi.json 
</code></pre>
  <pre><code>```
</code></pre>
  <ul>
   <li>
    Starting firmware update from URL:
   </li>
  </ul>
  <pre><code>```shell
</code></pre>
  <pre><code>curl -v http://&lt;RUUVI_GW_IP&gt;/fw_update.json 
</code></pre>
  <pre><code>  -H "Authorization: Bearer 1SDrQH1FkH+pON0GsSjt2gYeMSP02uYqfuu7LWdaBvY=" 
</code></pre>
  <pre><code>  -H 'Content-Type: application/json' 
</code></pre>
  <pre><code>  -d '{"url":"https://my_server.com:7000/gw_firmware/"}'
</code></pre>
  <pre><code>```
</code></pre>
  <ul>
   <li>
    A forced download of gateway configuration from the remote server (you must pre-configure the
   </li>
  </ul>
  <p>
   gateway and set the remote server URL):
  </p>
  <pre><code>```shell
</code></pre>
  <pre><code>curl -v http://&lt;RUUVI_GW_IP&gt;/gw_cfg_download 
</code></pre>
  <pre><code>  -H "Authorization: Bearer 1SDrQH1FkH+pON0GsSjt2gYeMSP02uYqfuu7LWdaBvY=" -d ''
</code></pre>
  <pre><code>```
</code></pre>
  <h2>
   Custom HTTP(S) / MQTT(S) sever
  </h2>
  <p>
   Ruuvi Gateway connects to the Ruuvi Cloud by default. However, you can configure it to use an HTTP
  </p>
  <p>
   or MQTT server to route data from your nearby sensors to a custom location instead.
  </p>
  <p>
   <img alt="cloud_options_advanced_settings" src="images/cloud_options_advanced_settings.png"/>
  </p>
  <p>
   You can enable or disable sending data to Ruuvi Cloud:
  </p>
  <p>
   <img alt="custom_server_ruuvi_cloud" src="images/custom_server_ruuvi_cloud.png"/>
  </p>
  <p>
   Or configure to send data to your own server via HTTP/HTTPS (sending to both Ruuvi Cloud and your
  </p>
  <p>
   own server is not supported yet):
  </p>
  <p>
   <img alt="custom_server_http" src="images/custom_server_http.png"/>
  </p>
  <p>
   Also, you can enable relaying data to MQTT server:
  </p>
  <p>
   <img alt="custom_server_mqtt" src="images/custom_server_mqtt.png"/>
  </p>
  <p>
   In the Statistics section, you can configure the sending of statistics to Ruuvi Cloud or your own
  </p>
  <p>
   server, or disable the sending of statistics:
  </p>
  <p>
   <img alt="custom_server_statistics" src="images/custom_server_statistics.png"/>
  </p>
  <h2>
   Time Synchronization Options
  </h2>
  <p>
   If the default set of NTP servers is not accessible, then you can specify the addresses of other NTP
  </p>
  <p>
   servers or use DHCP to obtain a list of NTP servers automatically. If the Ruuvi Gateway does not
  </p>
  <p>
   have access to the Internet and NTP, you can disable time synchronisation, but in this case, relayed
  </p>
  <p>
   messages will not contain timestamps.
  </p>
  <p>
   To configure NTP servers you need to enable advanced settings in the
   <strong>
    Cloud Options
   </strong>
   :
  </p>
  <p>
   <img alt="cloud_options_advanced_settings" src="images/cloud_options_advanced_settings.png"/>
  </p>
  <p>
   After that, you will be able to choose how to synchronise the time:
  </p>
  <p>
   <img alt="time_sync_default" src="images/time_sync_default.png"/>
  </p>
  <p>
   <img alt="time_sync_custom" src="images/time_sync_custom.png"/>
  </p>
  <h2>
   Bluetooth Scanning Settings
  </h2>
  <p>
   To get access to these settings you need to enable advanced settings in the
   <strong>
    Cloud Options
   </strong>
   :
  </p>
  <p>
   <img alt="cloud_options_advanced_settings" src="images/cloud_options_advanced_settings.png"/>
  </p>
  <p>
   By default, Ruuvi Gateway scans only for Ruuvi sensors (filtered by BLE SIG member ID 0x0499)
  </p>
  <p>
   <img alt="bluetooth_scanning_default" src="images/bluetooth_scanning_default.png"/>
  </p>
  <p>
   Also, you can enable Bluetooth long range (also known as Coded PHY).
  </p>
  <p>
   It is a new mode introduced in Bluetooth Version 5.0 to extend the range of Bluetooth devices from
  </p>
  <p>
   30-100 feet to ranges of 1 kilometer and beyond.
  </p>
  <p>
   <strong>
    Note
   </strong>
   : Most existing devices only transmit on 1 Mbps PHY. 1 Mbps and Coded PHYs modulations are
  </p>
  <p>
   scanned sequentially, so scanning both PHYs will result in at least 50% packet loss on one of the
  </p>
  <p>
   PHYs.
  </p>
  <p>
   <img alt="bluetooth_scanning_ruuvi_and_long_range" src="images/bluetooth_scanning_ruuvi_and_long_range.png"/>
  </p>
  <p>
   If you want to relay data from more than just Ruuvi sensors, you need to select the "**All
  </p>
  <p>
   (including third party beacons)**" option and adjust the scanned PHYs, Bluetooth channels used
  </p>
  <p>
   and the ability to use extended payload (BLE extended advertising):
  </p>
  <p>
   <img alt="bluetooth_scanning_all" src="images/bluetooth_scanning_all.png"/>
  </p>
  <p>
   <strong>
    Scan extended payloads
   </strong>
   . Both Coded PHY and 1 Mbps PHY may have a primary advertisement that
  </p>
  <p>
   tells that there is going to be extended data on a secondary channel. If "Use extended payload" is
  </p>
  <p>
   enabled, the secondary payload will be scanned.
  </p>
  <p>
   Coded PHY supports only Coded extended payload, 1 Mbps PHY supports scanning at 2 Mbps and 1 Mbps
  </p>
  <p>
   PHY extended payloads.
  </p>
  <p>
   <strong>
    Use channel
   </strong>
   . Each enabled BLE channel is scanned sequentially for a minimum of 7000 ms per
  </p>
  <p>
   channel, for a total of 21000 ms if all 3 channels are enabled. At least one channel must be active.
  </p>
 </body>
</html>